# RCNN

## 什么是目标检测
+ 找出ROI，确定位置和大小
+ 进行分类
## 目标检测核心问题
+ 目标可能出现在任何位置
+ 目标有不同大小
+ 目标有不同形状
## 传统的目标检测流程
1. 区域选择
  + 滑动窗口（设置不同的大小尺寸，不同的长宽对图像进行遍历搜索，寻找ROI）
    + 通过分类器给每个滑动窗口打分，并筛选分数最高的窗口
    + 在卷积层和池化层也有应用
    + 计算量大 
2. 特征提取
  + SIFT、HOG
    + HOG(Histogram of Gradient)：
    1. 图片灰度化（颜色对于轮廓检测不重要，灰度化后减少计算量）
    2. 进行Gamma矫正（降低图片局部阴影和光照变化的影响，同时抑制噪声）
    3. 将图片分割为cells
    5. 计算每个cell中所有像素的梯度值进行记录（最终构成[0,20,40,60,80,100,120,140,160]九个方向的9x1的vector），这个vector可以可视化
    5. 用设定好的stride的窗口进行滑动，窗口内vector进行concatenate，构成block的特征向量
    6. 由block特征向量构成整幅图的vector，由此将图片转化为计算机识别的信息。
    + SIFT（角点检测）：
      在不同的尺度空间上查找关键点（特征点），并计算出关键点的方向。SIFT所查找的关键点是一些十分突出，不会因光照，仿射变换和噪音等因素而变化的点。如角点、边缘点、暗区、暗区的亮点及亮区的暗点等。
  + SIFT、HOG缺点
    
    1. 人工设计
  + 如果要定位多个物体的话，有两个方法
    1. 将定位框视为回归问题
    2. 使用滑动窗口探测器
3. 分类器分类
  
  + SVM、adaboost算法
## 前期知识储备
+ 无监督和有监督
+ IOU
+ 非极大抑制（NMS）
  + 从一系列识别同一物体的预测框中选出最佳预测框，从一系列（iou>0.7）的区域中合并预测框
+ Selective search
  + 通过视觉特征（纹理、颜色、大小）减少候选框的数量以提高精度 
  + pip install selectiversearch
  + 通过图像分割算法初始化原始区域，将图像分为多个小块，使用贪心策略，计算每两个相邻区域的相似度，每次合并最相似的两块，直到最终只剩下一块完整的图片
## RCNN
1. RCNN目标检测的步骤
  + 将图片作为输入
  + 使用selective search 提取ROI，提取约2000个候选框
  + 对候选框进行调整（1. 各向异性缩放 2. 各项同性缩放），将每个区域传递给CNN
    + 各项异性缩放： 无论原始尺寸大小，强行将所有候选框缩放为227x227
    + 各项同性缩放： a. 先将ROI边界进行扩展为正方形再进行裁剪 b. 先按原比例裁剪，再用固定的背景颜色填充为正方形图片
    + 实验发现采用各项异性缩放、padding=16精度最高
  + CNN（AlexNet）为每个区域提取特征，用SVM为这些区域分类
    + 2000个特征用CNN提取后，形成2000x4096的矩阵
    + SVM是二分类器，将2000x4096矩阵与SVM的4096x20矩阵相乘，得到代表每一个候选框对应每一个候选类别得分的2000x20的矩阵 
  + 最后使用边界框回归（bounding box regression），目的是将框优化，框的更合适
    + 目的：减少定位偏差
    + 操作：平移+尺度放缩，训练出平移和放缩的四个参数，使得使用这四个参数进行变换后，predict更加接近ground-truth
    + 使用回归器对目标完成定位任务，然后使用NMS对每一类进行排除，最后得到该类得分最高的建议框（based on IOU）
2. 问题
  + 计算量大
    + 2000个候选框都要进行AlexNet，且每一个要使用20个SVM
  + 设计过于繁琐
## Note
+ RCNN未能做到实例分割，后续Mask RCNN可以做到实例分割水平
